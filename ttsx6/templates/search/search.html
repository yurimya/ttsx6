
{%extends 'goods/base.html'%}
{%block head%}
<script>
	function add_cart(gid) {
		//判断是否登录
		$.get('/user/islogin/',function (data) {
			if(data.islogin1){//如果登录则添加
				$.get('/cart/add/',{'gid':gid},function (data) {
				    if(data.isadd){//保存成功
//				        alert('购买成功');
				        $.get('/cart/count/',function (data) {
							$('#show_count').html(data.cart_count);
						});
					}else{//保存失败
				        alert('购买失败，请稍候重试');
					}
                });
			}else{//如果未登录则转向登录
			    location.href='/user/login/';
			}
        });
    }
</script>
{%endblock head%}
{%block left%}{%endblock left%}

{%block right%}
<ul class="goods_type_list clearfix">
    {%for goods in page_obj%}
    <li>
        <a href="/{{goods.object.id}}/"><img src="/static/{{goods.object.gpic}}"></a>
        <h4><a href="/{{goods.object.id}}/">{{goods.object.gtitle}}</a></h4>
        <div class="operate">
            <span class="prize">￥{{goods.object.gprice}}</span>
            <span class="unit">{{goods.object.gprice}}/{{goods.object.gunit}}</span>
            <a href="javascript:add_cart({{goods.object.id}});" class="add_goods" title="加入购物车"></a>
        </div>
    </li>
    {%endfor%}
</ul>

<div class="pagenation">
    {%if page_obj.has_previous%}
    <a href="?q={{query}}&page=1">首页</a>
    <a href="?q={{query}}&page={{page_obj.number|add:-1}}"><上一页</a>
    {%endif%}

    {%for pindex in page_range%}
    {%if pindex == page_obj.number%}
    <a href="#" class="active">{{pindex}}</a>
    {%else%}
    <a href="?q={{query}}&page={{pindex}}">{{pindex}}</a>
    {%endif%}
    {%endfor%}

    {%if page_obj.has_next%}
    <a href="?q={{query}}&page={{page_obj.number|add:1}}">下一页></a>
    <a href="?q={{query}}&page={{page_obj.paginator.num_pages}}">末页</a>
    {%endif%}
</div>
{%endblock right%}
